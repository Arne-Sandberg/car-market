<ng-template #editProfileModal>
  <div class="modal-header">
    <h2 class="modal-title">Edit profile</h2>
    <button type="button" class="close" aria-label="Close" (click)="closeModal()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form #userEdit="ngForm" enctype="multipart/form-data">
      <div class="form-group">
        <label for="image">Image</label>
        <input type="file" name="image" id="image" (change)="handleFileInput($event.target.files)">
      </div>
      <span class="error" *ngIf="error && error.image"><small>{{ error.image }}</small></span>
      <div class="form-group">
        <label for="email">Email</label>
        <input class="form-control" name="email" id="email" placeholder="email" type="email" [ngModel]="user.email">
        <span class="error" *ngIf="error && error.email"><small>{{ error.email }}</small></span>
      </div>
      <div class="form-group">
        <label for="first_name">First name</label>
        <input class="form-control" name="first_name" id="first_name" placeholder="first name" type="text"
               [ngModel]="user.first_name">
      </div>
      <div class="form-group">
        <label for="last_name">Last name</label>
        <input class="form-control" name="last_name" id="last_name" placeholder="last name" type="text"
               [ngModel]="user.last_name">
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-primary" (click)="edit(userEdit.value)">Save</button>
  </div>
</ng-template>

<div class="row" *ngIf="user">
  <div class="col-lg-3">
    <div class="card p-2">
      <img *ngIf="user.image" class="profile_img mx-auto thumbnail rounded" [src]="user.image">
      <img *ngIf="!user.image" class="profile_img mx-auto thumbnail rounded" src="static/images/default_user.png">
      <div class="card-body" *ngIf="isOwner()">
        <a (click)="openModal(editProfileModal)">Edit profile</a>
      </div>
    </div>
  </div>
  <div class="col-lg-9">
    <div class="row">
      <div class="col-lg">
        <h3><b>Personal information:</b></h3>
        <hr>
        <div class="my-2">
          <b>Username:</b> {{ user.username }}
        </div>
        <div class="my-2">
          <b>Email:</b> {{ user.email }}
        </div>
        <div class="my-2">
          <b>First name:</b> {{ user.first_name }}
        </div>
        <div class="my-2">
          <b>Last name:</b> {{ user.last_name }}
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-6 my-4">
        <h4>Cars:</h4>
        <hr>
        <div *ngFor="let car of user.car_set">
          <a routerLink="/cars/{{ car.id }}">
            {{ car.car_model }} {{ car.year }} - {{ car.car_type }}
          </a>
        </div>
      </div>
      <div class="col-lg-6 my-4">
        <h4>Purchases:</h4>
        <hr>
        <div *ngFor="let purchase of user.purchase_set">
          {{ purchase.car }} - ${{ purchase.price }}
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row" *ngIf="error && error.detail">
  <div class="col-lg">
    <h3>Errors:</h3>
    {{ error.detail }}
  </div>
</div>
